<!DOCTYPE html>
<!--[if lt IE 7]>
  <html class="lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>
  <html class="lt-ie9 lt-ie8" lang="en">
<![endif]-->
<!--[if IE 8]>
  <html class="lt-ie9" lang="en">
<![endif]-->
<!--[if gt IE 8]><!--> 
  <html lang="en"> 
<!--<![endif]-->
  <head> 
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no"> 
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"> 
    <title>Sears Locations#{if geocodeResult} - ${geocodeResult.city}, ${geocodeResult.state} ${geocodeResult.postalCode}#{/if}</title>
    <link rel="icon" type="image/png" href="/images/sears-favicon.png">
    <link rel="stylesheet" href="/css/storepages.css" type="text/css">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
    <script src="/js/perfect-scrollbar.min.js"></script>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?key=AIzaSyBzY9j4mYywVqpPXm9AdmWgMwgg3G5rTHY&sensor=false"></script> 
    <script type="text/javascript" src="/js/storepages.js"></script>
  </head> 
  <body id="location-page" class="store-pg store-results-page" onload="initialize()"> 
    <div class="top-head">
      <img src="/images/sears-top-head.png" >
    </div>
    <div id="page-container" class="cf">
      <div id="header" class="cf">
        <div class="head-left">
          <div class="logo">
            <img src="/images/sears-logo.png">
          </div>
          <div class="sub-head">
            <ul id="nav">
              <li class="storeLocater">
                <a href="" id="storeLocater" >Store Locator</a>
              </li>
              <li class="emailSavings">
                <a href="" id="emailSavings">Email Savings</a>
              </li>
              <li class="custService">
                <a href="" id="custService">Customer Service</a>
              </li>
              <li class="searsCC">
                <a href="" id="searsCC">Sears Credit Cards</a>
              </li>
              <li class="giftCards">
                <a href="" id="giftCards">Gift Cards</a>
              </li>
              <li class="DOD intShipHide">
                <a href="" id="DOD">Deals Of the Day</a>
              </li>
            </ul>
            <div class="search">
              <input class="search-box" type="text" name="search" placeholder="Find something great..." >
              <input class="search-btn" type="submit" src="/images/sears-search.png" name="submit" value="Search" >
            </div>
          </div>
        </div>
        <div class="head-right">
          <img src="/images/sears-head-right.png">
        </div>
      </div>
      <div id="page-content" class="cf">
        <div class="sub-nav find-sears search-content cf">
          <div class="nav find-sears-search">
            <h2>Find a Sears Location</h2>
            <input class="zip-city-state" name="zip-city-state" type="text" placeholder="Enter a Zip Code or City and State">
            <div class="go">
              <a href="" class="search-link">GO</a>
            </div>
          </div>
        </div>
        <div class="main-content results-content">
          <div class="results-sidebar">
            <div class="results-sidebar-header cf">
              <h1 class="number-results"><span class="large">${locations.size()}</span> stores near you</h1>
            </div>
            <div class="results-sidebar-content">
              #{list locations, as:'location'}
              <div id="result-${location_index}" class="result">
                <div class="location cf">
                  <a href="/${location.pageUrl}" class="location-address left">
                    <span class="number">${location_index}</span>
                    <h2>${location.name}</h2>
                    <p>
                      ${location.address} ${location.address2}<br>
                      ${location.city}, ${location.state} ${location.postalCode}<br>
                      <span class="phone">${location.mainPhone}</span><br><br>
		      ${location.distance} miles away
                    </p>
                  </a>
                  <div class="location-info right">
                    <a href="javascript:myclick(${location_index - 1})">Show in Map</a><br>
                    <a href="/${location.pageUrl}">More Info</a>
                  </div>
                </div>
                <div class="location-footer tags">
                  #{list location.services, as:'service'}
                  <span>${service}</span>
                  #{/list}
                </div>
              </div>
              <div id="result-dialog-${location_index}" style="display: none;">
                <div  class="result">
                  <div class="location-header">
                      <h2>${location.name}</h2>
                  </div>
                  <div class="location cf">
                    <div class="location-address left">
                        <p>
                        ${location.address} ${location.address2}<br>
                        ${location.city}, ${location.state} ${location.postalCode}<br>
                        <span class="phone">${location.mainPhone}</span>
                        <a href="/${location.pageUrl}">More Info</a> | <a href="">Directions</a>
                      </p>
                    </div>
                    <div class="location-hours right">
                      <table class="location-hours-table">
                        #{list location.hours, as:"hour"}
                        <tr>
                          <td class="day">${hour.day}</td>
                          #{list hour.intervals, as:"interval"}
                            <td class="hour">
                              <span class="time">${interval.start}</span> - <span class="time">${interval.end}</span>
                            </td>
                          #{/list}
                        </tr>
                        #{/list}
                      </table>
                    </div>                
                  </div>
                </div>
              </div>
              #{/list}
            </div>
          </div>
          <script>
          </script>
          <div id="results-map"></div> 
          <noscript><p><b>JavaScript must be enabled in order for you to use Google Maps.</b> 
            However, it seems JavaScript is either disabled or not supported by your browser. 
            To view Google Maps, enable JavaScript by changing your browser options, and then 
            try again.</p>
          </noscript>  
        </div>
      </div>
    </div>
    <script>
      #{list locations}
        #{if _isFirst}
        var latitude = ${_.latLng?.latitude},
            longitude = ${_.latLng?.longitude};
        #{/if}
      #{/list} 
      var gmarkers = []; 
      var map = null;
      var markers = [];

      function initialize() {
        var myOptions = {
          zoom: 11,
          center: new google.maps.LatLng(latitude, longitude),
          mapTypeControl: true,
          mapTypeControlOptions: {style: google.maps.MapTypeControlStyle.DROPDOWN_MENU},
          navigationControl: true,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        }
        map = new google.maps.Map(document.getElementById("results-map"), myOptions);
       
        google.maps.event.addListener(map, 'click', function() {
              infowindow.close();
        });

        for (i=0; i<markers.length; i++) {
          createMarker(markers[i].point, markers[i].storeName, markers[i].storeInfo)
        }

      }
     
      var infowindow = new google.maps.InfoWindow({ 
        size: new google.maps.Size(150,50)
      });
        
      function myclick(i) {
        google.maps.event.trigger(gmarkers[i], "click");
      }

      function createMarker(latlng, name, html) {
        var contentString = html;
        var marker = new google.maps.Marker({
            position: latlng,
            map: map,
            zIndex: Math.round(latlng.lat()*-100000)<<5
            });

        google.maps.event.addListener(marker, 'click', function() {
            infowindow.setContent(contentString); 
            infowindow.open(map,marker);
            });

        gmarkers.push(marker);

      }

      $(document).ready(function ($) {
        $('.results-sidebar-content').perfectScrollbar({
          wheelSpeed: 20,
          wheelPropagation: false
        });
      });

      function openDropdown(dropDown, size) {
        var dropDownObject = document.getElementById(dropDown);
        dropDownObject.size = size;
      }

      $(function() {
          var getName = function(storeNumber){
            return $('#result-' + storeNumber + ' h1').html();
          };

          var getDialog = function(storeNumber){
            return $('#result-dialog-' + storeNumber).html();
          };  

          #{list locations}
          var myMarker = {
            point : new google.maps.LatLng(${_.latLng?.latitude}, ${_.latLng?.longitude}),
            storeName : getName("${_index}"),
            storeInfo : getDialog("${_index}")
          }
          markers.push(myMarker);
          #{/list}  

          /*
          var markers = [
          
            {
              point : new google.maps.LatLng(${_.latLng?.latitude}, ${_.latLng?.longitude}),
              storeName : getName("${_index}"),
              storeInfo : getDialog("${_index}")
            }#{if _isLast}#{/if}#{else},#{/else}
          
          ];

          #{list locations}
            #{if _isFirst}
            /*var latitude = ${_.latLng?.latitude},
                longitude = ${_.latLng?.longitude};
            #{/if}
          #{/list} 
              */
          var resultsPage = new ResultsPage();
      });
    </script>
  </body>
</html> 
